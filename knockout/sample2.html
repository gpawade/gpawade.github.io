<html>
<head>
	<script type="text/javascript" src="../ref/js/knockout-3.3.0.js"></script>
	<script type="text/javascript" src="../ref/js/jquery.js"></script>
	<!-- Bootstrap -->
    <link href="../ref/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

	<h2>Customer <small data-bind="visible:list().length>0">(<span data-bind="text:list().length"></span>)</small></h2>


	<div class="container"> 


		<div class="alert alert-success" data-bind="visible:successMsg">
			<button class="close" type="button" data-dismiss="alert">X</button>
			<p>Record added succesfully!</p>
		</div>

	 	<div class="table-responsive">
		<table class="table table-bordered table-hover table-condensed" >
			<tr class="info">
				<th>#</th>
				<th>Name</th>
				<th>Phone</th>
				<th>Gender</th>
				<th>Company</th>
				<th>Email</th>
				<th>Address</th>
				<th>Action</th>
			</tr>
			
		<!-- ko foreach: list-->
			<tr data-bind="visible:!editable()">
				<td><span data-bind="text:id"></span> </td>
				<td><span data-bind="text:name"></span> </td>
				<td><span data-bind="text:phone"></span> </td>
				<td><span data-bind="text:gender"></span> </td>
				<td><span data-bind="text:company"></span> </td>
				<td><span data-bind="text:email"></span> </td>
				<td><span data-bind="text:address"></span> </td>
				<td>
					<div class="btn-group">
						<button data-bind="click:edit" class="btn btn-link">
							<span class="glyphicon glyphicon-edit"></span>
						</button>

						<button data-bind="click:remove" class="btn btn-link">
							<span class="glyphicon glyphicon-trash"></span>
						</button>
					</div>
				</td>
			</tr>
			<tr data-bind="visible:editable()">
				<td><input type="text" class="form-control input-sm" data-bind="value:id"/> </td>
				<td><input type="text" class="form-control input-sm"  data-bind="value:name"/> </td>
				<td><input type="text" class="form-control input-sm"  data-bind="value:phone"> </td>
				<td><input type="text" class="form-control input-sm"  data-bind="value:gender"> </td>
				<td><input type="text" class="form-control input-sm"  data-bind="value:company"></td>
				<td><input type="text" class="form-control input-sm"  data-bind="value:email"> </td>
				<td><input type="text" class="form-control input-sm"  data-bind="value:address"> </td>
				<td>
					<div class="input-group">
						<button data-bind="click:save" class="btn btn-link">
							<span class="glyphicon glyphicon-ok"></span>
						</button>
						<button data-bind="click:cancel" class="btn btn-link"><span class="glyphicon glyphicon-remove"></span></button>
					</div>
				 </td>
			</tr>
		<!--/ko-->	
		</table>
		</div>
		<button class="btn btn-success" data-bind="click:newrecord">New record</button>

		
		
	</div>


	<script type="text/javascript">

	var Customer = function(){
		this.id = ko.observable(0);
		this.name = ko.observable('');
		this.phone = ko.observable('');
		this.gender = ko.observable('');
		this.company = ko.observable('');
		this.email = ko.observable('');
		this.address = ko.observable('');

		this.editable = ko.observable(false);

		this.isnew =ko.observable(false);

		this.edit = function(){

			this.editable(true);
		}

		this.save = function(){
			this.editable(false);
		}

		this.cancel=function(){
			if(this.isnew())
				this.remove();
			else
				this.editable(false);


			
		}

		this.remove=function(){

			viewModel.list.remove(this);
		}

	};

	var viewModel = {
		list : ko.observableArray(),
		editView : false,
		successMsg : ko.observable(false),

		errorMsg : ko.observable(false),

		
		newrecord: function(){
			var cust = new Customer();
			cust.id = this.list().length;
			cust.editable(true);
			cust.isnew(true);
			this.editView = true;
			this.list.push(cust);
		}

	};

	var uiAction = {

		 showSuccess : function(){
		 	viewModel.successMsg(true);

			setTimeout(function(){
				viewModel.successMsg(false);
			}, 1000);
		 },

		 showError : function(){
		 	viewModel.errorMsg(true);

			setTimeout(function(){
				viewModel.errorMsg(false);
			}, 1000);
		 },

	};



	ko.applyBindings(viewModel);

	
	var toCustomerModel = function(item){

		var c = new Customer();
		c.id(item.id);
		c.name(item.name);
		c.phone(item.phone);
		c.gender(item.gender);
		c.company(item.company);
		c.email(item.email);
		c.address(item.address);

		return c;
	};

	var setDummyData = function(){

		viewModel.list.push(toCustomerModel({
			
			    "id": 0,
			    "name": "Rivera Williamson",
			    "gender": "male",
			    "company": "DIGIRANG",
			    "email": "riverawilliamson@digirang.com",
			    "phone": "+1 (914) 580-2149",
			    "address": "582 Preston Court, Dante, American Samoa, 8257"
			  }
		));

		viewModel.list.push(toCustomerModel(
			{
			    "id": 1,
			    "name": "Gregory Hinton",
			    "gender": "male",
			    "company": "ISBOL",
			    "email": "gregoryhinton@isbol.com",
			    "phone": "+1 (817) 538-2471",
			    "address": "309 Brigham Street, Bellfountain, Connecticut, 1568"
			  }
		));
		viewModel.list.push(toCustomerModel(
			{
			    "id": 2,
			    "name": "Clarice Navarro",
			    "gender": "female",
			    "company": "PYRAMIA",
			    "email": "claricenavarro@pyramia.com",
			    "phone": "+1 (842) 497-2263",
			    "address": "948 Cyrus Avenue, Breinigsville, Iowa, 4155"
			  }
		));
	};

	$.getJSON('../ref/data/customers.json', function(res){

		$.each(res,function(i,item){
			 viewModel.list.push(toCustomerModel(item));
		});

	}).fail(function(){
		setDummyData();
	});


	</script>



</body>
</html>